{% extends "recipe_manager/base_generic.html" %}

{% block content %}

<style>
	input[type="number"] {
		width: 80px;
	}
	td,th {
		text-align: center;
	}
	table {
		border-spacing: 10px;
		border-collapse: separate;
	}
</style>

<h3 align="center">{% if recipe.id %}Editing Recipe '{{recipe.name}}' {% else %} New Recipe {% endif %}</h3>

<div class="row">
	<div class="col-8 offset-1">
		
		<form action="" method="post">
			{% csrf_token %}
			<input type="hidden" name="objective" value="saveName" />
			<table>
				<tr>
					<td>Name:</td>
					<td>{{form_name.name}}</td>
					<td><button type="submit" class="btn btn-primary">Save</button></td>
				</tr>
			</table>
		</form>

		<p></p>
		<hr/>

		{% if recipe.id %}
		<fieldset>
			<legend>Ingredient list</legend>
	
			<form action="" method="post">
				{% csrf_token %}
				<input type="hidden" name="objective" value="addIngredient" />
				{{form_ingredient.ingredient}}: {{form_ingredient.quantity}} <span id="unit">grams</span> <button type="submit" class="btn btn-primary">Add</button>
			</form>

			<table>
				<tr>
					<th>Ingredient</th>
					<th>Ammount</th>
					<th>Price</th>
					<th>Cost</th>
					<th>Remove</th>
				</tr>
				{% for ingredient_list in recipe_list.all %}
					<tr>
						<td>{{ingredient_list.ingredient.name}}</td>
						<td>{{ingredient_list.quantity|floatformat:"-2"}} {{ingredient_list.ingredient.quantityUnit}}</td>
						<td>{{ingredient_list.ingredient.currency|floatformat:"-2"}} {{ingredient_list.ingredient.currencyUnit}} per {{ingredient_list.ingredient.quantity|floatformat:"-2"}} {{ingredient_list.ingredient.quantityUnit}}</td>
						<td>{{price_list|get_item:ingredient_list.ingredient.id|floatformat:"-2"}} {{ingredient_list.ingredient.currencyUnit}}</td>
						<td><a href="{% url 'recipe_manager:remove ingredient from recipe' recipe_id=recipe.id ingredient_id=ingredient_list.ingredient.id %}"><i class="bi bi-eraser"></i></a></td>
					</tr>
				{% endfor %}
			</table>
		</fieldset>

		<b>Total recipe cost: {{price_list|sum_dict_items|floatformat:"-2"}}</b>
		<br>
		<br>
		{% endif %}
	</div>
</div>  

<a class="btn btn-primary" href="{% url 'recipe_manager:home' %}">Back</a>

{% if recipe.id %}
	<a class="btn btn-danger" href="{% url 'recipe_manager:remove recipe' recipe_id=recipe.id %}"><i class="bi bi-eraser"></i> Remove</a>
{% endif %}

<script>
	$('select#id_ingredient').change((e) => {
		console.log($('select#id_ingredient').val())
	})	
</script>
1234567890
1234567890

{% endblock %}